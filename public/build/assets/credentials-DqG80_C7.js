import{u as k,r as c,j as e,H as N}from"./app-Cfw5N1hp.js";import{B as w}from"./app-logo-icon-BweiERlG.js";import{C as v,a as C,b as T,c as b,d as E}from"./card-BxE2vReu.js";import{L as g}from"./label-BdhhK7-J.js";import{T as K}from"./toast-VHrURHGi.js";import{A as _}from"./app-sidebar-layout-DkUe-6Vs.js";/* empty css            */import"./index-Y00ChMLq.js";import"./index-Dkf1XcQA.js";function B(){const u=k().props,a=u.flash||null,s=u.credentials||a&&a.credentials||null,y=u.user||null,[O,I]=c.useState(!1),[d,j]=c.useState(!1),[x,i]=c.useState(!1),[h,m]=c.useState(a&&a.success?{message:a.success,type:"success"}:a&&a.error?{message:a.error,type:"error"}:null);c.useEffect(()=>{if(s&&typeof window<"u")try{const t=`user_credentials_${s.email}`,r=`user_credentials_sent_${s.email}`,o=sessionStorage.getItem(t);if(o)try{const n=JSON.parse(o);n&&n.temporary_password===s.temporary_password?sessionStorage.getItem(r)==="1"&&i(!0):(sessionStorage.removeItem(r),sessionStorage.setItem(t,JSON.stringify(s)),i(!1))}catch{sessionStorage.removeItem(r),sessionStorage.setItem(t,JSON.stringify(s)),i(!1)}else sessionStorage.setItem(t,JSON.stringify(s)),i(!1)}catch{}},[s]);const R=async(t,r)=>{try{await navigator.clipboard.writeText(t),r(!0),setTimeout(()=>r(!1),2e3)}catch{console.error("コピーに失敗しました")}},S=[{title:"ダッシュボード",href:route("dashboard")},{title:"ユーザー管理",href:route("users.index")},{title:"ログイン情報",href:""}];if(!s)return e.jsxs(_,{breadcrumbs:S,children:[e.jsx(N,{title:"ログイン情報"}),e.jsx("div",{className:"py-12",children:e.jsx("div",{className:"mx-auto max-w-2xl sm:px-6 lg:px-8",children:e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(T,{children:"ログイン情報"})}),e.jsx(b,{children:e.jsx("p",{children:"表示するログイン情報がありません。ユーザー作成後に表示されます。"})})]})})})]});const p=route("login"),X=typeof p=="string"&&p.match(/^https?:\/\//)?p:window.location.origin+p;return e.jsxs(_,{breadcrumbs:S,children:[e.jsx(N,{title:"ログイン情報"}),e.jsx("div",{className:"py-12",children:e.jsxs("div",{className:"mx-auto max-w-2xl sm:px-6 lg:px-8",children:[h&&e.jsx(K,{message:h.message,type:h.type,onClose:()=>m(null)}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsx(T,{children:"登録完了 - ログイン情報"})}),e.jsxs(b,{children:[e.jsx("p",{className:"mb-2",children:"以下の情報でログインできます。初回ログイン時にパスワードの変更が必要です。"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx(g,{children:"名前"}),e.jsx("div",{className:"rounded-md bg-gray-100 p-2",children:s.name})]}),e.jsxs("div",{children:[e.jsx(g,{children:"メールアドレス (ID)"}),e.jsx("div",{className:"rounded-md bg-gray-100 p-2",children:s.email})]}),e.jsxs("div",{children:[e.jsx(g,{children:"仮パスワード"}),e.jsx("div",{className:"rounded-md bg-gray-100 p-2 font-mono",children:s.temporary_password})]})]})]}),e.jsxs(E,{className:"flex justify-end gap-4",children:[e.jsx(w,{variant:"outline",disabled:d||x,"aria-busy":d,onClick:async()=>{if(!(d||x)){j(!0);try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",r=(document.cookie||"").split("; ").find(f=>f.startsWith("XSRF-TOKEN=")),o=r?decodeURIComponent(r.split("=")[1]):"";let n;y?n=await fetch(route("users.credentials.send",y.id),{method:"POST",credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json","X-CSRF-TOKEN":t,"X-XSRF-TOKEN":o}}):n=await fetch(route("users.credentials.send.by_email"),{method:"POST",credentials:"include",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Content-Type":"application/json","X-CSRF-TOKEN":t,"X-XSRF-TOKEN":o},body:JSON.stringify({email:s.email})});let l=null;try{l=await n.json()}catch{}if(n.ok){m({message:l&&l.message||"送信しました",type:"success"}),i(!0);try{const f=`user_credentials_sent_${s.email}`;sessionStorage.setItem(f,"1")}catch{}}else m({message:l&&l.error||`送信に失敗しました (HTTP ${n.status})`,type:"error"})}catch(t){console.error(t),m({message:"送信に失敗しました",type:"error"})}finally{j(!1)}}},children:d?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"mr-2 -ml-1 h-5 w-5 animate-spin text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})]}),"送信中"]}):x?"送信済み":"送信"}),e.jsx(w,{onClick:()=>R(`名前：${s.name}
ログインID：${s.email}
仮パスワード：${s.temporary_password}
ログインページ：${X}
`,I),children:"コピー"}),O&&e.jsx("div",{className:"ml-3 text-sm text-green-600",children:"コピーしました"})]})]})]})})]})}export{B as default};
