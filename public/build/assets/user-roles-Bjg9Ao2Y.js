import{r as a,u as k,a as o,j as s,H as U}from"./app-fAu9F8Qa.js";import{T as w}from"./toast-NxCvUzdU.js";import{H}from"./heading-NX2FQOTU.js";import{B as P}from"./app-logo-icon-BgJucqo0.js";import{C as E,a as R,b as T,c as $}from"./card-Cgnbhpij.js";import{C as L}from"./checkbox-C5bundKt.js";import{L as A}from"./label-C17sZWtq.js";import{A as B}from"./app-sidebar-layout-DOACWoPa.js";/* empty css            */import"./index-CXCml9p6.js";import"./index-46EnhBWJ.js";const _=[{title:"各種設定",href:"#"},{title:"ユーザーへのロール割り当て",href:route("admin.user-roles")}];function X(){const[n,f]=a.useState([]),[j,g]=a.useState([]),[r,b]=a.useState(null),[i,l]=a.useState({}),[m,u]=a.useState(!1),[c,p]=a.useState(null),N=k().props?.auth?.permissions??[],v=e=>N.includes(e);a.useEffect(()=>{h(),C()},[]);const h=async()=>{const e=await o.get("/api/users");f(e.data)},C=async()=>{const e=await o.get("/api/roles");g(e.data)},y=e=>{const t=n.find(d=>d.id===e)||null;b(t);const x={};(t?.roles||[]).forEach(d=>{x[d.id]=!0}),l(x)},S=async()=>{if(!r)return;u(!0);const e=Object.keys(i).filter(t=>i[Number(t)]).map(Number);await o.post(`/api/users/${r.id}/roles`,{role_ids:e}),await h(),u(!1),p({message:"保存しました",type:"success"})};return s.jsxs(B,{breadcrumbs:_,children:[s.jsx(U,{title:"ユーザーへのロール割り当て"}),s.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[s.jsx("div",{className:"mb-6",children:s.jsx(H,{title:"ユーザーへのロール割り当て",description:"各ユーザーにどの役割を持たせるかを設定する。"})}),s.jsxs(E,{children:[s.jsx(R,{children:s.jsx(T,{children:"ユーザーとロールの関連付け"})}),s.jsx($,{children:s.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[s.jsxs("div",{className:"rounded-md border",children:[s.jsx("div",{className:"border-b p-2 font-semibold",children:"ユーザー"}),s.jsx("ul",{className:"max-h-96 overflow-y-auto",children:n.map(e=>s.jsx("li",{className:`cursor-pointer p-2 text-sm hover:bg-muted/50 ${r?.id===e.id?"bg-muted":""}`,onClick:()=>y(e.id),children:e.name},e.id))})]}),s.jsx("div",{className:"md:col-span-2",children:r?s.jsxs("div",{children:[s.jsxs("h3",{className:"mb-4 text-lg font-medium",children:[r.name," のロール"]}),s.jsx("div",{className:"space-y-3",children:j.map(e=>s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(L,{id:`role-${e.id}`,checked:!!i[e.id],onCheckedChange:()=>l(t=>({...t,[e.id]:!t[e.id]}))}),s.jsx(A,{htmlFor:`role-${e.id}`,className:"font-normal",children:e.name})]},e.id))}),s.jsx("div",{className:"mt-6 flex justify-end",children:v("user.update")&&s.jsx(P,{onClick:S,disabled:m,children:m?"保存中...":"保存"})})]}):s.jsx("div",{className:"flex h-full min-h-48 items-center justify-center text-muted-foreground",children:"左のリストからユーザーを選択してください"})})]})})]}),c&&s.jsx(w,{message:c.message,type:c.type,onClose:()=>p(null)})]})]})}export{X as default};
